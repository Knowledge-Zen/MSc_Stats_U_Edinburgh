% Custom style file
\ProvidesPackage{custom}

% Required packages
\RequirePackage{amsmath,amssymb}
\RequirePackage{amsthm}
\RequirePackage{graphicx}
\RequirePackage{titlesec}
\RequirePackage{fancyhdr}
\RequirePackage[margin=1in]{geometry}
\RequirePackage{booktabs}
\RequirePackage{lmodern}
\RequirePackage{xcolor}
\RequirePackage{enumitem}
\RequirePackage[titles]{tocloft}
\RequirePackage{natbib}
\RequirePackage{tikz}
\RequirePackage{mdframed}
\RequirePackage{microtype}
\RequirePackage{parskip}

% Define colors
\definecolor{chaptercolor}{RGB}{70,130,180}
\definecolor{sectioncolor}{RGB}{0,90,120}
\definecolor{subsectioncolor}{RGB}{0,60,80}

% Command to set up hyperref (to be used in the main .tex file)
\newcommand{\setuphyperref}{%
    \usepackage[hidelinks,colorlinks=true,linkcolor=sectioncolor,filecolor=magenta,urlcolor=cyan]{hyperref}
    \hypersetup{
        pdftitle={A Comprehensive Guide to Probability},
        pdfauthor={Your Name},
        bookmarks=true,
        pdfpagemode=UseOutlines,
    }
}

% Fancy headers and footers
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\textit{\leftmark}}
\fancyhead[LO]{\textit{\rightmark}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}}

% Remove blank pages
\let\cleardoublepage\clearpage

% Chapter formatting
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\color{chaptercolor}}
{\tikz[remember picture,overlay] \node[fill=chaptercolor!20,inner sep=10pt,rounded corners] at (current page.north east) {\chaptertitlename\ \thechapter};}
{20pt}
{\Huge}
\titlespacing*{\chapter}{0pt}{50pt}{40pt}

% Section formatting
\titleformat{\section}
{\normalfont\Large\bfseries\color{sectioncolor}}
{\thesection}{1em}{}
\titlespacing*{\section}{0pt}{20pt}{10pt}

% Subsection formatting
\titleformat{\subsection}
{\normalfont\large\bfseries\color{subsectioncolor}}
{\thesubsection}{1em}{}
\titlespacing*{\subsection}{0pt}{15pt}{10pt}

% Customizing lists
\setlist[itemize]{noitemsep, topsep=0pt, leftmargin=*}
\setlist[enumerate]{noitemsep, topsep=0pt, leftmargin=*}

% Customizing table of contents
\renewcommand{\cftchapfont}{\bfseries\color{chaptercolor}}
\renewcommand{\cftsecfont}{\color{sectioncolor}}
\renewcommand{\cftsubsecfont}{\color{subsectioncolor}}
\renewcommand{\cftchappagefont}{\bfseries\color{chaptercolor}}
\renewcommand{\cftsecpagefont}{\color{sectioncolor}}
\renewcommand{\cftsubsecpagefont}{\color{subsectioncolor}}
\setlength{\cftbeforechapskip}{1.5em}
\setlength{\cftbeforesecskip}{0.75em}

% Theorem environments
\newtheoremstyle{customthm}
{10pt}   % Space above
{10pt}   % Space below
{\itshape}  % Body font
{}       % Indent amount
{\bfseries\color{sectioncolor}} % Theorem head font
{.}      % Punctuation after theorem head
{.5em}   % Space after theorem head
{}       % Theorem head spec

\theoremstyle{customthm}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\newtheoremstyle{customdef}
{10pt}   % Space above
{10pt}   % Space below
{}       % Body font
{}       % Indent amount
{\bfseries\color{subsectioncolor}} % Theorem head font
{.}      % Punctuation after theorem head
{.5em}   % Space after theorem head
{}       % Theorem head spec

\theoremstyle{customdef}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{example}{Example}[chapter]

% Custom box for important notes
\newmdenv[
    linecolor=chaptercolor,
    linewidth=2pt,
    topline=false,
    bottomline=false,
    rightline=false,
    leftmargin=10pt,
    rightmargin=10pt,
    backgroundcolor=chaptercolor!10,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
]{importantbox}

\newenvironment{important}{\begin{importantbox}\textbf{Important:}}{\end{importantbox}}

% Custom environment for ending marker in examples
\newenvironment{exampleend}{\par\medskip\noindent\centering\begin{endmarkerbox}\dots\end{endmarkerbox}\par\medskip}{}

% Customizing the bibliography
\setcitestyle{numbers,square}
\bibliographystyle{plainnat}

% Enable microtype for better typography
\microtypesetup{protrusion=true, expansion=true}

% Custom caption style
\RequirePackage[font=small,labelfont=bf,labelsep=period]{caption}

% Enhanced figure settings
\RequirePackage{subfig}
\captionsetup[figure]{font=small,labelfont=bf,labelsep=period}

% Side-by-side figures
\newenvironment{figurehere}
{\par\medskip\noindent\minipage{\linewidth}}
{\endminipage\par\medskip}

% Enhanced table settings
\RequirePackage{booktabs}
\RequirePackage{array}
\RequirePackage{tabularx}
\captionsetup[table]{font=small,labelfont=bf,labelsep=period}

% Improved column types
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}


% Code block settings
\RequirePackage{listings}
\RequirePackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=mystyle}

% Python-specific settings
\lstdefinelanguage{Python}{
    keywords={and, as, assert, break, class, continue, def, del, elif, else, except, False, finally, for, from, global, if, import, in, is, lambda, None, nonlocal, not, or, pass, raise, return, True, try, while, with, yield},
    keywordstyle=\color{magenta},
    string=[s]{"}{"},
    stringstyle=\color{codepurple},
    comment=[l]{\#},
    commentstyle=\color{codegreen}
}


% Chapter formatting
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\color{chaptercolor}}
{
    \begin{tikzpicture}[remember picture, overlay]
        \fill[chaptercolor!20] (current page.north east) rectangle ([xshift=-\textwidth, yshift=-2cm]current page.north east);
        \node[anchor=north east, inner sep=10pt, font=\huge\bfseries, text=chaptercolor]
        at ([xshift=-10pt, yshift=-10pt]current page.north east)
        {\chaptername\ \thechapter};
    \end{tikzpicture}
}
{20pt}
{\Huge}
\titlespacing*{\chapter}{0pt}{-20pt}{40pt}

% Set paragraph spacing
\setlength{\parskip}{10pt} % Adjust as needed